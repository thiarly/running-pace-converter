{% extends "base.html" %}

{% block titulo %}
Impress√£o do Resumo ‚Äî {{ resumo.nome_treino }}
{% endblock %}

{% block content %}

<style>
  /* Margem da p√°gina impressa */
  @page { size: A4; margin: 16mm; }

  /* Esconde navbar/rodap√© s√≥ na impress√£o */
  @media print {
    header, nav, footer,
    .navbar, .site-header, .site-footer,
    .no-print, [data-print="hide"] {
      display: none !important;
      visibility: hidden !important;
      height: 0 !important;
    }
    /* tira sombras/bordas fortes e evita cortes */
    .print-card { box-shadow: none !important; border-color: #e5e7eb !important; }
  }

  /* Respiro topo/rodap√© do conte√∫do */
  .print-wrap { padding-top: 12mm; padding-bottom: 8mm; }
</style>

{% macro formatar_tempo_decimal(decimal) %}
  {% if decimal is not none %}
    {% set horas = decimal|int %}
    {% set minutos = ((decimal - horas) * 60)|round(0, 'floor') %}
    {{ horas }}h{{ "%02d"|format(minutos) }}m
  {% else %}
    -
  {% endif %}
{% endmacro %}

<!-- ADJUST: adicionadas classes print-card e print-wrap -->

<a href="/" class="flex items-center">
    <img src="{{ url_for('static', filename='image/tcsports1.png') }}" alt="Logo" class="h-10">
    
  </a>


<div class="max-w-4xl mx-auto bg-white p-6 rounded shadow print-card print-wrap">
  <h1 class="text-2xl font-bold mb-2">{{ resumo.nome_treino }}</h1>
  <p class="text-sm text-gray-600 mb-4">{{ resumo.data.strftime('%d/%m/%Y') }}</p>

  {% if resumo.comentario %}
  <div class="mb-6">
    <h2 class="text-lg font-semibold mb-1">üìù Coment√°rio</h2>
    <p class="whitespace-pre-wrap">{{ resumo.comentario }}</p>
  </div>
  {% endif %}

  {% if resumo.suplementos_utilizados %}
  <div class="mb-6">
    <h2 class="text-lg font-semibold mb-1">üß™ Suplementos utilizados</h2>
    <ul class="list-disc list-inside text-sm text-gray-700">
      {% for item in resumo.suplementos_utilizados.split(',') %}
        <li>{{ item.strip() }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <div class="mb-6">
    <h2 class="text-lg font-semibold mb-1">‚è±Ô∏è Tempos</h2>
    <p><strong>Total:</strong> {{ formatar_tempo_decimal(resumo.tempo_total) }}</p>
    <p>
      <strong>Nata√ß√£o:</strong> {{ formatar_tempo_decimal(resumo.tempo_natacao) }} |
      <strong>Bike:</strong> {{ formatar_tempo_decimal(resumo.tempo_bike) }} |
      <strong>Corrida:</strong> {{ formatar_tempo_decimal(resumo.tempo_corrida) }}
    </p>
  </div>

  {% set ordem = ["Macronutrientes","Eletr√≥litos","Estimulantes e Compostos","Vitaminas","Amino√°cidos"] %}
  {% set ordem_eletrolitos = ["S√≥dio","Magn√©sio","Pot√°ssio","C√°lcio"] %}

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    {% for categoria in ordem %}
      {% if resumo.resumo_dados.get(categoria) %}
        {% set dados = resumo.resumo_dados[categoria] %}
        {% if categoria == "Eletr√≥litos" %}
          {% set total = namespace(v=0) %}
          {% for k in ordem_eletrolitos %}
            {% set total.v = total.v + (dados.get(k,0) or 0) %}
          {% endfor %}
          {% set mostrar = total.v > 0 %}
        {% else %}
          {% set soma = dados.values() | map('float') | sum %}
          {% set mostrar = soma > 0 %}
        {% endif %}

        {% if mostrar %}
        <div class="p-3 rounded border">
          <h3 class="font-semibold text-gray-900 mb-1">
            {{ "üíß" if categoria=="Eletr√≥litos" else ("üî•" if categoria=="Macronutrientes" else ("‚ö°" if categoria=="Estimulantes e Compostos" else ("üíä" if categoria=="Vitaminas" else "üß¨"))) }}
            {{ categoria }}
          </h3>
          <ul class="list-disc list-inside text-sm text-gray-800">
            {% if categoria == "Eletr√≥litos" %}
              {% for item in ordem_eletrolitos %}
                {% set valor = dados.get(item,0) %}
                {% if valor > 0 %}
                  <li><strong>{{ item }}:</strong>
                    {{ valor|round(1) }} {{ unidades[categoria].get(item,'') }}/h ‚á•
                    {{ (valor * resumo.tempo_total)|round(1) }} {{ unidades[categoria].get(item,'') }} total
                  </li>
                {% endif %}
              {% endfor %}
            {% else %}
              {% for item, valor in dados.items() if valor > 0 %}
                <li><strong>{{ item }}:</strong>
                  {{ valor|round(1) }} {{ unidades[categoria].get(item,'') }}/h ‚á•
                  {{ (valor * resumo.tempo_total)|round(1) }} {{ unidades[categoria].get(item,'') }} total
                </li>
              {% endfor %}
            {% endif %}
          </ul>
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>
</div>

<script>
  // imprime e fecha a aba ap√≥s imprimir
  window.addEventListener("load", () => window.print());
  window.addEventListener("afterprint", () => window.close());
</script>

{% endblock %}